<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tesco List Helper</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 0 16px;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-size: 1rem;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
    }
    .note {
      font-size: 0.9rem;
      color: #666;
      margin-top: 10px;
    }
    ul.preview {
      margin-top: 10px;
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <h1>Tesco Shopping List Launcher</h1>
  <p>Paste your shopping list below (format: <code>item | quantity</code>):</p>
  <textarea id="shoppingList" placeholder="e.g. kitchen roll | 4\napple juice | 2"></textarea>
  <button onclick="previewList()">Preview List</button>
  <div id="previewContainer" style="display:none">
    <h2>Preview:</h2>
    <ul class="preview" id="previewList"></ul>
    <button onclick="launchSearch()">Search on Tesco</button>
  </div>
  <p class="note">Each item will open in a new tab with a visual quantity cue added to the tab title. Does not affect search results.</p>

  <script>
    let parsedItems = [];

    function previewList() {
      const rawList = document.getElementById('shoppingList').value;
      parsedItems = rawList
        .split(/\n+/)
        .map(line => line.split('|').map(s => s.trim()))
        .filter(([item]) => item.length > 0);

      const previewEl = document.getElementById('previewList');
      previewEl.innerHTML = '';
      parsedItems.forEach(([item, qty]) => {
        const li = document.createElement('li');
        li.textContent = `${item}${qty ? ' (x' + qty + ')' : ''}`;
        previewEl.appendChild(li);
      });

      document.getElementById('previewContainer').style.display = 'block';
    }

    function launchSearch() {
      const delay = 1000;
      parsedItems.forEach(([item, qty], i) => {
        setTimeout(() => {
          const url = `https://www.tesco.com/groceries/en-GB/search?query=${encodeURIComponent(item)}`;
          const newTab = window.open(url, '_blank');
          if (newTab) {
            newTab.onload = function() {
              try {
                newTab.document.title += qty ? ` (x${qty})` : '';
              } catch (e) {
                console.log('Tab loaded but title could not be set (possibly due to cross-origin restriction)');
              }
            };
          }
        }, i * delay);
      });
    }
  </script>
</body>
</html>
